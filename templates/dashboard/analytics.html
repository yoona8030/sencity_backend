{% extends "dashboard/base.html" %} {% load static %} {% block title %}데이터 분석 및 통계{% endblock %} {% block extra_head %}
<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Page CSS -->
<link rel="stylesheet" href="{% static 'dashboard/css/analytics.css' %}?v=2025-11-06" />

<!-- CSRF (필요 시 JS fetch에서 사용) -->
<meta name="csrf-token" content="{{ csrf_token }}" />
{% endblock %} {% block content %}
<div class="dashboard-body wrap page-analytics">
  <h1 class="page-title">데이터 분석 및 통계</h1>

  <div class="page-header">
    <div>
      <div class="page-subtitle">연도 선택 후 전체 통계를 확인합니다.</div>
    </div>
    <div class="page-tools">
      <label for="year-global" class="sr-only">연도</label>
      <select id="year-global"></select>
      <button id="apply-global" class="btn">적용</button>
    </div>
  </div>

  <!-- KPIs -->
  <section class="kpis">
    <div class="card">
      <div class="kpi-title">연간 총 신고 수</div>
      <div id="kpi-total" class="kpi-value">-</div>
    </div>
    <div class="card">
      <div class="kpi-title">월 평균</div>
      <div id="kpi-avg" class="kpi-value">-</div>
    </div>
    <div class="card">
      <div class="kpi-title">최다 신고월</div>
      <div id="kpi-peak" class="kpi-value">-</div>
    </div>
    <div class="card">
      <div class="kpi-title">최다 동물</div>
      <div id="kpi-top" class="kpi-value">-</div>
    </div>
  </section>

  <!-- 메인 그리드 -->
  <section class="analytics-grid">
    <!-- 월별 신고 건수 -->
    <article class="card card--bar">
      <h2>월별 신고 건수</h2>
      <div class="chart"><canvas id="barMonthly"></canvas></div>
    </article>

    <!-- 동물별 분포 -->
    <article class="card card--donut-right" id="animal-donut">
      <h2>동물별 분포</h2>
      <div class="donut-split">
        <canvas id="donutAnimal"></canvas>
        <div id="legend-animal" class="legend--right" aria-label="도넛 범례"></div>
      </div>
    </article>

    <!-- 지역 분포(지도) -->
    <article class="card card--map">
      <h2>지역 분포 (지도)</h2>
      <div class="imgmap-toolbar">
        <label class="sr-only" for="map-animal">동물</label>
        <select id="map-animal">
          <option value="">전체</option>
          <option>고라니</option>
          <option>너구리</option>
          <option>멧돼지</option>
          <option>왜가리</option>
          <option>족제비</option>
          <option>기타</option>
        </select>
        <button id="map-apply" class="btn">적용</button>
        <button id="map-lock" class="btn" aria-pressed="false" title="지도를 고정합니다">고정</button>
      </div>
      <div class="leaflet-wrap">
        <div id="leafletMap" role="region" aria-label="신고 지점 지도"></div>
        <div class="legend--map-vertical" aria-hidden="true">
          <span class="legend-max">많음</span>
          <div class="legend-bar-vertical"></div>
          <span class="legend-min">적음</span>
        </div>
      </div>
    </article>

    <!-- 월별 신고 추이 -->
    <article class="card card--line">
      <h2>월별 신고 추이</h2>
      <div class="chart chart--line"><canvas id="lineMonthly"></canvas></div>
    </article>
  </section>
</div>

<!-- Page JS -->
<script defer src="{% static 'dashboard/js/analytics.js' %}?v=2025-11-06"></script>
{% endblock %}
